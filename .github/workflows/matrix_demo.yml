name: 🧪 Matrix Filter Demo

on:
  schedule:
    - cron: '0 14 * * 1'
  workflow_dispatch:
    inputs:
      service:
        description: 'Service to test'
        required: false
        default: ''
      env:
        description: 'Environment to test'
        required: false
        default: ''

jobs:
  simulate:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        include:
          - service: sample
            env: stg
          - service: sample
            env: uat
          - service: user
            env: stg
          - service: user
            env: uat

    steps:
      - name: ⛔ Skip unmatched matrix (exit job)
        if: ${{ github.event_name == 'workflow_dispatch' && (
                (github.event.inputs.service != '' && github.event.inputs.service != matrix.service) ||
                (github.event.inputs.env != '' && github.event.inputs.env != matrix.env)
              ) }}
        run: |
          echo "❌ Skipping job — matrix does not match inputs"
          exit 1
        continue-on-error: true  # Mark the job green despite exit

      - name: 📢 Print Info
        run: |
          echo "🚀 Running job..."
          echo "Triggered by: ${{ github.event_name }}"
          echo "Input service: ${{ github.event.inputs.service }}"
          echo "Input env:     ${{ github.event.inputs.env }}"
          echo "Matrix service: ${{ matrix.service }}"
          echo "Matrix env:     ${{ matrix.env }}"
